<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>MotorJS Web Example</title>
		<script type="text/javascript" src="../dist/web/index.js"></script>
	</head>
	<body>
		<h1>Inaza JS SDK Example</h1>
		<pre disabled style="width: 100%; height: 100vh" id="console"></pre>
	</body>
	<script type="text/javascript">
		// Read credentials from environment file. Make sure environment file is present in the root directory of the repository. If not, create one from env.example.json.
		fetch("../env.json")
			.then((response) => response.json())
			.then((env) => {
				// Initialise Auth
				let auth = new motorJS.Auth({
					orgId: env.init.orgId,
					region: env.init.region,
					email: env.auth.email,
					password: env.auth.password,
					accountType: env.auth.accountType,
				});

				// Login
				auth.login()
					.then((res) => {
						appendSuccessToConsole(`Login successful. Token: ${JSON.stringify(res, null, 2)}\n\n`);
					})
					.catch((err) => {
						appendErrorToConsole(`Login failed. Error: ${JSON.stringify(err, null, 2)}\n\n`);
					});

				// Initialise the Motor SDK and pass the Auth object
				let motor = new motorJS.Motor({
					orgId: env.init.orgId,
					region: env.init.region,
					storage: window.localStorage, // Set storage to localStorage to persist the user session
					auth: auth,
				});

				motor
					.orgSettings()
					.then((res) => {
						appendSuccessToConsole(`Org settings: ${JSON.stringify(res, null, 2)}\n\n`);
					})
					.catch((err) => {
						appendErrorToConsole(`Org settings failed. Error: ${JSON.stringify(err, null, 2)}\n\n`);
					});

				motor
					.getDriver({
						driverId: env.testing.driverId1,
					})
					.then((res) => {
						appendSuccessToConsole(`Driver: ${JSON.stringify(res, null, 2)}\n\n`);
					})
					.catch((err) => {
						appendErrorToConsole(`Error fetching driver. Error: ${JSON.stringify(err, null, 2)}\n\n`);
					});

				motor
					.createDriver({
						driver: {
							firstName: "FirstName",
							lastName: "LastName",
							email: "someEmail@org.com",
						},
						password: "$tr0ngP@ssw0rd",
					})
					.then((res) => {
						appendSuccessToConsole(`Driver Created: ${res.fullName()}\n\n`);
					})
					.catch((err) => {
						appendErrorToConsole(`Driver Creation Error: ${JSON.stringify(err, null, 2)}\n\n`);
					});

				motor
					.getVehicle({
						vehicleId: env.testing.rvId1,
					})
					.then((res) => {
						appendSuccessToConsole(`Vehicle: ${JSON.stringify(res, null, 2)}\n\n`);
					})
					.catch((err) => {
						appendErrorToConsole(`Error fetching vehicle: ${JSON.stringify(err, null, 2)}\n\n`);
					});
			});
	</script>

	<script>
		function appendToConsole(value) {
			document.getElementById("console").innerHTML = "<span class='info'>" + document.getElementById("console").innerHTML + value + "</span>\n";
		}

		function appendSuccessToConsole(value) {
			document.getElementById("console").innerHTML = "<span class='success'>" + document.getElementById("console").innerHTML + value + "</span>\n";
		}

		function appendErrorToConsole(value) {
			document.getElementById("console").innerHTML = "<span class='error'>" + document.getElementById("console").innerHTML + value + "</span>\n";
		}
	</script>

	<style>
		#console {
			width: -webkit-fill-available !important;
			height: 85vh !important;
			background: #000;
			color: #fff;
			padding: 15px;
			border-radius: 10px;
			overflow: scroll;
		}
		#console .info {
			color: white;
		}
		#console .success {
			color: green;
		}
		#console .error {
			color: red;
		}
	</style>
</html>
